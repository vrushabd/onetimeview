<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-8327032298153859">

    <!-- Primary SEO Meta Tags -->
    <title>Create Secure Self-Destructing Link - OneTimeView</title>
    <meta name="description"
        content="Create a secure, encrypted one-time link for messages and files. Password protect your secret and set it to self-destruct after viewing. Free and anonymous.">
    <meta name="keywords"
        content="create secret link, secure message generator, self destruct file upload, password protected link, encrypted note, temporary url, share secret">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://onetimeview.app/create">

    <!-- Mobile & Theme -->
    <meta name="theme-color" content="#22d3ee">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://onetimeview.app/create">
    <meta property="og:title" content="Create Secure One-Time Link">
    <meta property="og:description"
        content="Generate a secure link that automatically deletes itself after being viewed. Protect your sensitive data.">
    <meta property="og:image" content="https://onetimeview.com/static/og-image.jpg">
    <meta property="og:site_name" content="OneTimeView">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://onetimeview.app/create">
    <meta name="twitter:title" content="Create Secure One-Time Link">
    <meta name="twitter:description"
        content="Generate a secure link that automatically deletes itself after being viewed. Protect your sensitive data.">
    <meta name="twitter:image" content="https://onetimeview.com/static/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

    <!-- Performance Optimization -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/tailwind-config.js"></script>
    <script src="/static/config.js"></script>
    <script src="/static/cookie-consent.js" defer></script>
    <link rel="stylesheet" href="/static/styles.css">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Create Secret Link",
      "description": "Create secure self-destructing links for confidential messages and files",
      "url": "https://onetimeview.app/create",
      "potentialAction": {
        "@type": "CreateAction",
        "name": "Create Secret",
        "target": "https://onetimeview.app/create"
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://onetimeview.app/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Create Secret",
          "item": "https://onetimeview.app/create"
        }
      ]
    }
    </script>
    <!-- Vercel Web Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <!-- Vercel Speed Insights -->
    <script>
        window.si = window.si || function () { (window.si.q = window.si.q || []).push(arguments); };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
</head>

<body class="bg-background min-h-screen text-text-primary bg-grid-pattern relative overflow-x-hidden">
    <div class="bg-noise"></div>

    <!-- Navigation -->
    <nav class="border-b border-white/5 backdrop-blur-md sticky top-0 z-40 bg-background/80">
        <div class="container mx-auto px-6 py-4 flex items-center gap-4 flex-wrap md:flex-nowrap justify-between">
            <a href="/" class="flex items-center gap-2 group flex-shrink-0">
                <div
                    class="relative flex items-center justify-center w-10 h-10 rounded-xl bg-card border border-primary/30 shadow-glow-sm group-hover:shadow-glow transition-all duration-300">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                </div>
                <span
                    class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-primary-light to-primary group-hover:to-white transition-all">OneTimeView</span>
            </a>
            <div class="flex gap-6 md:gap-8 text-sm md:text-base font-medium">
                <a href="/" class="text-text-secondary hover:text-primary transition-colors hover:glow-text">Home</a>
                <a href="/privacy"
                    class="text-text-secondary hover:text-primary transition-colors hover:glow-text">Privacy</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-12 relative z-10">
        <div class="max-w-2xl mx-auto">

            <div id="successMessage"
                class="hidden glass rounded-2xl p-8 mb-8 border-primary/30 shadow-glow animate-fade-in-up">
                <div class="flex items-center gap-4 mb-6">
                    <div
                        class="w-12 h-12 rounded-full bg-success/20 flex items-center justify-center text-success border border-success/30 shadow-glow-sm">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white">Secret Created!</h3>
                        <p class="text-text-secondary">Your secure link is ready to share.</p>
                    </div>
                </div>

                <div class="relative mb-6">
                    <input type="text" id="secretLink" readonly
                        class="w-full bg-background/50 border border-primary/30 rounded-xl px-5 py-4 text-white font-mono text-sm pr-32 focus:outline-none focus:border-primary focus:shadow-glow-sm transition-all">
                    <button onclick="copyLink()"
                        class="absolute right-2 top-2 bottom-2 bg-primary hover:bg-primary-hover text-background font-bold px-6 rounded-lg transition-all shadow-glow-sm hover:shadow-glow flex items-center gap-2">
                        Copy
                    </button>
                </div>

                <div class="flex items-start gap-3 bg-white/5 rounded-lg p-4 mb-6 border border-white/5">
                    <span class="text-xl">⚠️</span>
                    <p class="text-sm text-text-secondary" id="expiryInfo"></p>
                </div>

                <div class="text-center">
                    <a href="/create"
                        class="inline-flex items-center gap-2 text-primary hover:text-white transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Create another secret
                    </a>
                </div>
            </div>

            <form id="secretForm" class="glass rounded-2xl border-white/10 shadow-2xl relative overflow-hidden group">
                <!-- Top accent line -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-accent"></div>

                <div class="p-8 md:p-10 space-y-8">
                    <div class="text-center mb-8">
                        <div
                            class="mx-auto w-16 h-16 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center mb-4 text-primary shadow-glow-sm">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                                </path>
                            </svg>
                        </div>
                        <h1 class="text-3xl font-bold text-white mb-2">Create a Secret</h1>
                        <p class="text-text-secondary">Your message will self-destruct after being read once.</p>
                    </div>

                    <!-- Content Type Selection (Compact) -->
                    <div class="grid grid-cols-4 gap-2 p-1 bg-background/50 rounded-xl border border-white/5">
                        <button type="button" onclick="selectType('text')" id="btn-text"
                            class="type-btn rounded-lg py-2 text-sm font-medium transition-all flex flex-col items-center gap-1 hover:bg-white/5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Text
                        </button>
                        <button type="button" onclick="selectType('image')" id="btn-image"
                            class="type-btn rounded-lg py-2 text-sm font-medium transition-all flex flex-col items-center gap-1 hover:bg-white/5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            Image
                        </button>
                        <button type="button" onclick="selectType('video')" id="btn-video"
                            class="type-btn rounded-lg py-2 text-sm font-medium transition-all flex flex-col items-center gap-1 hover:bg-white/5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                                </path>
                            </svg>
                            Video
                        </button>
                        <button type="button" onclick="selectType('file')" id="btn-file"
                            class="type-btn rounded-lg py-2 text-sm font-medium transition-all flex flex-col items-center gap-1 hover:bg-white/5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            File
                        </button>
                    </div>

                    <!-- Text Content -->
                    <div id="textContent">
                        <label class="block text-sm font-bold mb-2 ml-1">Your Secret</label>
                        <textarea id="contentField" rows="6"
                            class="w-full bg-background/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-text-muted focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-all resize-none font-mono text-sm"
                            placeholder="Enter your secret message, password, or sensitive data..."></textarea>
                    </div>

                    <!-- File Upload -->
                    <div id="fileContent" class="hidden">
                        <label class="block text-sm font-bold mb-2 ml-1">Upload File</label>
                        <div class="upload-area border-2 border-dashed border-white/20 hover:border-primary/50 bg-background/30 rounded-xl p-8 text-center cursor-pointer transition-all"
                            id="uploadArea" ondrop="handleDrop(event)" ondragover="handleDragOver(event)"
                            ondragleave="handleDragLeave(event)" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect(event)">
                            <div class="flex justify-center mb-3">
                                <div class="p-3 rounded-full bg-primary/10 text-primary">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                            <p class="font-bold text-white mb-1">Click to upload or drag and drop</p>
                            <p class="text-xs text-text-muted">Maximum file size 100MB</p>

                            <div id="fileInfo"
                                class="hidden mt-4 bg-primary/10 border border-primary/20 rounded-lg p-3 flex items-center gap-3">
                                <svg class="w-5 h-5 text-primary flex-shrink-0" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                    </path>
                                </svg>
                                <div class="text-left overflow-hidden">
                                    <p class="text-sm font-bold text-white truncate" id="fileName"></p>
                                    <p class="text-xs text-text-secondary" id="fileSize"></p>
                                </div>
                            </div>

                            <div id="uploadProgress" class="hidden mt-4">
                                <div class="w-full bg-background rounded-full h-1.5 overflow-hidden">
                                    <div id="progressBar" class="bg-primary h-full transition-all duration-300"
                                        style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-primary mt-2 animate-pulse" id="progressText">Uploading...</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <!-- Password Toggle -->
                        <div
                            class="flex items-center justify-between bg-background/30 p-4 rounded-xl border border-white/5">
                            <div class="flex items-center gap-3">
                                <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                                    </path>
                                </svg>
                                <span class="text-sm font-medium">Password Protection</span>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="passwordToggle" class="sr-only peer"
                                    onchange="togglePasswordSection()">
                                <div
                                    class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                            </label>
                        </div>

                        <div id="passwordSection" class="hidden animate-fade-in">
                            <input type="password" id="passwordField"
                                class="w-full bg-background/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-text-muted focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-all text-sm"
                                placeholder="Enter a password (optional)">
                        </div>

                        <!-- Full width expiration and view limits -->
                        <div class="space-y-4">
                            <!-- Expiration Section -->
                            <div class="bg-background/30 p-4 rounded-xl border border-white/5">
                                <label class="block text-lg font-bold mb-3 flex items-center gap-2">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <span>Expiration</span>
                                </label>
                                <select id="expiryField"
                                    class="w-full bg-background border border-card-border rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none">
                                    <option value="0">Never expires</option>
                                    <option value="5">5 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="1440" selected>24 hours</option>
                                    <option value="10080">7 days</option>
                                </select>
                                <p class="text-sm text-text-secondary mt-2">Content will also be deleted after reaching
                                    the view limit below.</p>
                            </div>

                            <!-- View Limit Section -->
                            <div class="bg-background/30 p-4 rounded-xl border border-white/5 space-y-2">
                                <div class="flex items-center justify-between">
                                    <label
                                        class="text-xs font-mono text-text-secondary uppercase flex items-center gap-2">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                            </path>
                                        </svg>
                                        View Limit
                                    </label>
                                    <div id="viewLimitHelperText"
                                        class="text-xs text-primary-light/80 italic animate-fade-in pl-1">
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="maxViewsField" min="1" max="100" value="1"
                                        class="bg-transparent text-white focus:outline-none text-sm w-full font-mono text-lg"
                                        onchange="updateViewLimitHelperText()">
                                    <span class="text-xs text-text-muted whitespace-nowrap">views</span>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden Premium Toggle -->
                        <input type="checkbox" id="isPremium" class="hidden">

                        <button type="submit"
                            class="w-full bg-primary hover:bg-primary-hover text-background font-bold py-4 rounded-xl px-6 text-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-glow flex items-center justify-center gap-2 group/btn">
                            <svg class="w-5 h-5 group-hover/btn:rotate-12 transition-transform" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                                </path>
                            </svg>
                            Generate Secret Link
                        </button>
                    </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Update type selection styling
        function selectType(type) {
            selectedType = type;

            // Reset all buttons
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-background', 'shadow-glow-sm');
                btn.classList.add('hover:bg-white/5');
            });

            // Activate selected
            const activeBtn = document.getElementById(`btn-${type}`);
            activeBtn.classList.add('bg-primary', 'text-background', 'shadow-glow-sm');
            activeBtn.classList.remove('hover:bg-white/5');

            // Update file input accept attribute
            const fileInput = document.getElementById('fileInput');
            if (type === 'image') fileInput.setAttribute('accept', 'image/*');
            else if (type === 'video') fileInput.setAttribute('accept', 'video/*');
            else fileInput.setAttribute('accept', '*/*');

            // Toggle content areas
            if (type === 'text') {
                document.getElementById('textContent').classList.remove('hidden');
                document.getElementById('fileContent').classList.add('hidden');
            } else {
                document.getElementById('textContent').classList.add('hidden');
                document.getElementById('fileContent').classList.remove('hidden');
            }
        }

        function togglePasswordSection() {
            const section = document.getElementById('passwordSection');
            const toggle = document.getElementById('passwordToggle');
            if (toggle.checked) {
                section.classList.remove('hidden');
                document.getElementById('passwordField').focus();
            } else {
                section.classList.add('hidden');
                document.getElementById('passwordField').value = '';
            }
        }

    </script>
    <p class="text-center text-sm text-text-secondary mt-4">
        By creating a secret, you agree to our <a href="/terms" class="text-primary-light hover:underline">Terms of
            Service</a>
    </p>
    </form>
    </div>
    </div>

    <script>
        let selectedType = 'text';
        let selectedFile = null;
        const MAX_FILE_SIZE_MB = 100;

        // Initialize view limit helper text on page load
        document.addEventListener('DOMContentLoaded', function () {
            updateViewLimitHelperText();
        });

        function updateViewLimitHelperText() {
            const maxViews = parseInt(document.getElementById('maxViewsField').value);
            const helperDiv = document.getElementById('viewLimitHelperText');

            if (maxViews === 1) {
                helperDiv.innerHTML = `
                    <div class="flex items-start space-x-2 bg-primary/10 border border-primary/30 rounded-lg p-3">
                        <span class="text-primary-light">✓</span>
                        <span class="text-primary-light font-medium">This is a one-time view link.</span>
                    </div>
                `;
            } else {
                helperDiv.innerHTML = `
                    <div class="flex items-start space-x-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3">
                        <span class="text-yellow-400">⚠</span>
                        <span class="text-yellow-400">Anyone with this link can open it until the view limit is reached.</span>
                    </div>
                `;
            }
        }

        function selectType(type) {
            selectedType = type;

            // Update button states
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary/20');
            });
            document.getElementById(`btn-${type}`).classList.add('border-primary', 'bg-primary/20');

            // Update file input accept attribute based on content type
            const fileInput = document.getElementById('fileInput');
            if (type === 'image') {
                fileInput.setAttribute('accept', 'image/*');
            } else if (type === 'video') {
                fileInput.setAttribute('accept', 'video/*');
            } else if (type === 'file') {
                fileInput.setAttribute('accept', '*/*');
            }

            // Show/hide content areas
            if (type === 'text') {
                document.getElementById('textContent').classList.remove('hidden');
                document.getElementById('fileContent').classList.add('hidden');
            } else {
                document.getElementById('textContent').classList.add('hidden');
                document.getElementById('fileContent').classList.remove('hidden');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.add('dragging');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragging');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragging');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        function handleFile(file) {
            selectedFile = file;
            const sizeMb = file.size / 1024 / 1024;

            if (sizeMb > MAX_FILE_SIZE_MB) {
                selectedFile = null;
                document.getElementById('fileInfo').classList.add('hidden');
                document.getElementById('fileInput').value = '';
                alert(`This file is ${sizeMb.toFixed(2)} MB. The maximum allowed size is ${MAX_FILE_SIZE_MB} MB. Please choose a smaller file.`);
                return;
            }

            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = `${sizeMb.toFixed(2)} MB`;
        }

        async function getCloudinarySignature(resourceType) {
            const res = await fetch(API_BASE_URL + '/api/uploads/sign', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ resource_type: resourceType })
            });
            if (!res.ok) {
                const err = await res.json().catch(() => ({}));
                throw new Error(err.detail || 'Failed to prepare upload');
            }
            return res.json();
        }

        function uploadFileToCloudinary(file, contentType, onProgress) {
            const resourceType = contentType === 'video' ? 'video' : 'raw';
            return getCloudinarySignature(resourceType).then(sign => {
                const url = `https://api.cloudinary.com/v1_1/${sign.cloud_name}/${sign.resource_type}/upload`;
                const fd = new FormData();
                fd.append('file', file);
                fd.append('api_key', sign.api_key);
                fd.append('timestamp', sign.timestamp);
                fd.append('signature', sign.signature);
                fd.append('folder', sign.folder);

                return new Promise((resolve, reject) => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', url, true);

                    if (xhr.upload && onProgress) {
                        xhr.upload.onprogress = onProgress;
                    }

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status >= 200 && xhr.status < 300) {
                                try {
                                    const data = JSON.parse(xhr.responseText);
                                    resolve(data);
                                } catch (e) {
                                    reject(new Error('Upload response parse error'));
                                }
                            } else {
                                reject(new Error('Cloud storage upload failed'));
                            }
                        }
                    };

                    xhr.onerror = function () {
                        reject(new Error('Network error during file upload'));
                    };

                    xhr.send(fd);
                });
            });
        }

        // Fallback: upload file through our API (old behavior)
        function uploadFileViaBackend(file, contentType, onProgress) {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('content_type', contentType);
                formData.append('file', file);

                const xhr = new XMLHttpRequest();
                xhr.open('POST', API_BASE_URL + '/api/secrets', true);

                if (xhr.upload && onProgress) {
                    xhr.upload.onprogress = onProgress;
                }

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status >= 200 && xhr.status < 300) {
                            try {
                                const data = JSON.parse(xhr.responseText);
                                resolve({ backend_secret: data });
                            } catch (e) {
                                reject(new Error('Upload response parse error'));
                            }
                        } else {
                            reject(new Error('Backend upload failed'));
                        }
                    }
                };

                xhr.onerror = function () {
                    reject(new Error('Network error during file upload'));
                };

                xhr.send(formData);
            });
        }

        document.getElementById('secretForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitButton = document.querySelector('#secretForm button[type="submit"]');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            const isPremium = document.getElementById('isPremium').checked;
            const expiryMinutes = parseInt(document.getElementById('expiryField').value);
            const maxViews = parseInt(document.getElementById('maxViewsField').value);
            const password = document.getElementById('passwordField').value || null;

            try {
                submitButton.disabled = true;
                submitButton.classList.add('opacity-70', 'cursor-not-allowed');

                if (selectedType === 'text') {
                    const content = document.getElementById('contentField').value;
                    if (!content.trim()) {
                        alert('Please enter a message');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('content_type', 'text');
                    formData.append('content', content);
                    formData.append('is_premium', isPremium);
                    formData.append('expiry_minutes', expiryMinutes);
                    formData.append('max_views', maxViews);
                    if (password) {
                        formData.append('password', password);
                    }

                    const res = await fetch(API_BASE_URL + '/api/secrets', {
                        method: 'POST',
                        body: formData
                    });
                    if (!res.ok) {
                        const err = await res.json().catch(() => ({}));
                        throw new Error(err.detail || 'Failed to create secret');
                    }
                    const data = await res.json();

                    document.getElementById('secretForm').classList.add('hidden');
                    document.getElementById('successMessage').classList.remove('hidden');
                    document.getElementById('secretLink').value = data.url;

                    if (data.expires_at) {
                        const expiryDate = new Date(data.expires_at);
                        const viewText = data.max_views === 1 ? 'first view' : `${data.max_views} views`;
                        document.getElementById('expiryInfo').textContent =
                            `⏰ Expires on ${expiryDate.toLocaleString()} or after ${viewText}`;
                    } else {
                        const viewText = data.max_views === 1 ? 'first view' : `${data.max_views} views`;
                        document.getElementById('expiryInfo').textContent =
                            `⚠️ Will be deleted after ${viewText}`;
                    }

                    document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
                    return;
                }

                // File / image / video flow: direct to Cloudinary, then create secret
                if (!selectedFile) {
                    alert('Please select a file');
                    return;
                }

                // Reset and show progress UI
                uploadProgress.classList.remove('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = 'Starting upload...';
                uploadProgress.scrollIntoView({ behavior: 'smooth', block: 'center' });

                let finalSecretData = null;

                try {
                    // Preferred path: direct to Cloudinary
                    const cloudinaryResponse = await uploadFileToCloudinary(
                        selectedFile,
                        selectedType,
                        function (event) {
                            if (event.lengthComputable && event.total > 0) {
                                const rawPercent = Math.round((event.loaded / event.total) * 100);
                                const percent = Math.min(rawPercent, 95);
                                progressBar.style.width = percent + '%';
                                progressText.textContent = `Uploading... ${percent}%`;
                            } else {
                                progressText.textContent = 'Uploading...';
                            }
                        }
                    );

                    // Small finalization step with your API
                    progressBar.style.width = '95%';
                    progressText.textContent = 'Finalizing...';

                    const payload = {
                        content_type: selectedType,
                        file_name: selectedFile.name,
                        mime_type: selectedFile.type,
                        cloud_url: cloudinaryResponse.secure_url,
                        cloud_public_id: cloudinaryResponse.public_id,
                        cloud_resource_type: cloudinaryResponse.resource_type,
                        password,
                        expiry_minutes: expiryMinutes,
                        max_views: maxViews,
                        is_premium: isPremium
                    };

                    const res = await fetch(API_BASE_URL + '/api/secrets/from-cloudinary', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        const err = await res.json().catch(() => ({}));
                        throw new Error(err.detail || 'Failed to create secret');
                    }

                    finalSecretData = await res.json();
                } catch (cloudErr) {
                    // Fallback: try legacy backend upload if direct upload path fails (e.g. endpoint not deployed yet)
                    console.error('Direct cloud upload failed, falling back to backend upload:', cloudErr);
                    progressBar.style.width = '0%';
                    progressText.textContent = 'Network seems slow, trying via server...';

                    const backendResult = await uploadFileViaBackend(
                        selectedFile,
                        selectedType,
                        function (event) {
                            if (event.lengthComputable && event.total > 0) {
                                const rawPercent = Math.round((event.loaded / event.total) * 100);
                                const percent = Math.min(rawPercent, 95);
                                progressBar.style.width = percent + '%';
                                progressText.textContent = `Uploading... ${percent}%`;
                            } else {
                                progressText.textContent = 'Uploading...';
                            }
                        }
                    );

                    finalSecretData = backendResult.backend_secret;
                }

                progressBar.style.width = '100%';
                progressText.textContent = 'Done!';

                document.getElementById('secretForm').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
                document.getElementById('secretLink').value = finalSecretData.url;

                if (finalSecretData.expires_at) {
                    const expiryDate = new Date(finalSecretData.expires_at);
                    const viewText = finalSecretData.max_views === 1 ? 'first view' : `${finalSecretData.max_views} views`;
                    document.getElementById('expiryInfo').textContent =
                        `⏰ Expires on ${expiryDate.toLocaleString()} or after ${viewText}`;
                } else {
                    const viewText = finalSecretData.max_views === 1 ? 'first view' : `${finalSecretData.max_views} views`;
                    document.getElementById('expiryInfo').textContent =
                        `⚠️ Will be deleted after ${viewText}`;
                }

                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                let message = error.message || 'Upload failed. Please try again.';
                if (message.includes('Network')) {
                    message = 'Upload failed due to network issues. Please check your connection or try a smaller file.';
                } else if (message.toLowerCase().includes('failed')) {
                    message = 'Upload failed. Please try again with a smaller file or more stable connection.';
                }
                alert(message);
                uploadProgress.classList.add('hidden');
            } finally {
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        });

        function copyLink() {
            const linkInput = document.getElementById('secretLink');
            linkInput.select();
            document.execCommand('copy');

            // Show toast notification
            showToast('Link copied to clipboard!');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';

            // Create SVG checkmark icon
            const svgIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svgIcon.setAttribute('width', '20');
            svgIcon.setAttribute('height', '20');
            svgIcon.setAttribute('viewBox', '0 0 24 24');
            svgIcon.setAttribute('fill', 'none');
            svgIcon.setAttribute('stroke', 'currentColor');
            svgIcon.setAttribute('stroke-width', '3');
            svgIcon.setAttribute('stroke-linecap', 'round');
            svgIcon.setAttribute('stroke-linejoin', 'round');
            svgIcon.style.flexShrink = '0';

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', 'M20 6L9 17L4 12');

            svgIcon.appendChild(path);

            toast.appendChild(svgIcon);
            toast.appendChild(document.createTextNode(message));
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize
        selectType('text');

        // Check if redirected from homepage with success
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true' && urlParams.get('url')) {
            const secretUrl = decodeURIComponent(urlParams.get('url'));

            // Hide the form and show success message
            document.getElementById('secretForm').classList.add('hidden');
            document.getElementById('successMessage').classList.remove('hidden');
            document.getElementById('secretLink').value = secretUrl;

            // Set default expiry info for quick creation
            document.getElementById('expiryInfo').textContent =
                '⚠️ Will be deleted after first view or in 24 hours';

            // Scroll to success message
            document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });

            // Clean up URL
            window.history.replaceState({}, document.title, '/create');
        }
    </script>
</body>

</html>